{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        },
        "university": {
          "type": "string",
          "description": "University the user attends."
        },
        "fieldOfStudy": {
          "type": "string",
          "description": "User's field of study."
        },
        "bio": {
          "type": "string",
          "description": "User's biography or description."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates if the user's account is verified."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the user was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Housing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Housing",
      "type": "object",
      "description": "Represents a housing listing on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the housing entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Housing)"
        },
        "title": {
          "type": "string",
          "description": "Title of the housing listing."
        },
        "description": {
          "type": "string",
          "description": "Description of the housing."
        },
        "type": {
          "type": "string",
          "description": "Type of housing (e.g., kot, studio, colocation)."
        },
        "price": {
          "type": "number",
          "description": "Price of the housing."
        },
        "address": {
          "type": "string",
          "description": "Address of the housing."
        },
        "city": {
          "type": "string",
          "description": "City where the housing is located."
        },
        "postalCode": {
          "type": "string",
          "description": "Postal code of the housing."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the housing location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the housing location."
        },
        "bedrooms": {
          "type": "number",
          "description": "Number of bedrooms in the housing."
        },
        "bathrooms": {
          "type": "number",
          "description": "Number of bathrooms in the housing."
        },
        "surfaceArea": {
          "type": "number",
          "description": "Surface area of the housing in square meters."
        },
        "availableFrom": {
          "type": "string",
          "description": "Date when the housing is available from.",
          "format": "date-time"
        },
        "photos": {
          "type": "array",
          "description": "Array of URLs to photos of the housing.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "Array of amenities offered by the housing (e.g., wifi, parking, furnished).",
          "items": {
            "type": "string"
          }
        },
        "universityNearby": {
          "type": "string",
          "description": "Name of the university nearby."
        },
        "distanceToCampus": {
          "type": "number",
          "description": "Distance to campus in meters."
        },
        "isAvailable": {
          "type": "boolean",
          "description": "Indicates if the housing is currently available."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the housing listing was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the housing listing was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "type",
        "price",
        "address",
        "city"
      ]
    },
    "Carpooling": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Carpooling",
      "type": "object",
      "description": "Represents a carpooling offer on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the carpooling entity."
        },
        "driverId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Carpooling)"
        },
        "departureCity": {
          "type": "string",
          "description": "City of departure."
        },
        "departureAddress": {
          "type": "string",
          "description": "Departure address."
        },
        "arrivalCity": {
          "type": "string",
          "description": "City of arrival."
        },
        "arrivalAddress": {
          "type": "string",
          "description": "Arrival address."
        },
        "departureTime": {
          "type": "string",
          "description": "Departure time.",
          "format": "date-time"
        },
        "seatsAvailable": {
          "type": "number",
          "description": "Number of seats available."
        },
        "pricePerSeat": {
          "type": "number",
          "description": "Price per seat."
        },
        "description": {
          "type": "string",
          "description": "Description of the carpooling offer."
        },
        "carModel": {
          "type": "string",
          "description": "Car model."
        },
        "preferences": {
          "type": "array",
          "description": "Array of preferences (e.g., non-smoking, music, animals).",
          "items": {
            "type": "string"
          }
        },
        "isRecurring": {
          "type": "boolean",
          "description": "Indicates if the carpooling is recurring."
        },
        "recurringDays": {
          "type": "array",
          "description": "Array of recurring days (e.g., Monday, Wednesday).",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the carpooling (e.g., active, full, completed, cancelled)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the carpooling offer was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "driverId",
        "departureCity",
        "arrivalCity",
        "departureTime",
        "seatsAvailable"
      ]
    },
    "CarpoolBooking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CarpoolBooking",
      "type": "object",
      "description": "Represents a booking for a carpooling offer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the carpool booking entity."
        },
        "carpoolId": {
          "type": "string",
          "description": "Reference to Carpooling. (Relationship: Carpooling 1:N CarpoolBooking)"
        },
        "passengerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CarpoolBooking)"
        },
        "seatsBooked": {
          "type": "number",
          "description": "Number of seats booked."
        },
        "status": {
          "type": "string",
          "description": "Status of the booking (e.g., pending, confirmed, cancelled)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the booking was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "carpoolId",
        "passengerId"
      ]
    },
    "Tutoring": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tutoring",
      "type": "object",
      "description": "Represents a tutoring offer on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tutoring entity."
        },
        "tutorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Tutoring)"
        },
        "subject": {
          "type": "string",
          "description": "Subject of tutoring."
        },
        "level": {
          "type": "string",
          "description": "Level of tutoring (e.g., bachelier, master, secondaire)."
        },
        "description": {
          "type": "string",
          "description": "Description of the tutoring offer."
        },
        "pricePerHour": {
          "type": "number",
          "description": "Price per hour for tutoring."
        },
        "locationType": {
          "type": "string",
          "description": "Type of location (e.g., online, in-person, both)."
        },
        "availableLocations": {
          "type": "array",
          "description": "Array of available locations (cities or campuses).",
          "items": {
            "type": "string"
          }
        },
        "availability": {
          "type": "string",
          "description": "Availability of the tutor (e.g., JSON format)."
        },
        "rating": {
          "type": "number",
          "description": "Average rating of the tutor."
        },
        "totalReviews": {
          "type": "number",
          "description": "Total number of reviews for the tutor."
        },
        "qualifications": {
          "type": "array",
          "description": "Array of qualifications of the tutor.",
          "items": {
            "type": "string"
          }
        },
        "isAvailable": {
          "type": "boolean",
          "description": "Indicates if the tutor is currently available."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the tutoring offer was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tutorId",
        "subject",
        "level"
      ]
    },
    "TutoringReview": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TutoringReview",
      "type": "object",
      "description": "Represents a review for a tutoring offer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the tutoring review entity."
        },
        "tutoringId": {
          "type": "string",
          "description": "Reference to Tutoring. (Relationship: Tutoring 1:N TutoringReview)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TutoringReview)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the student (1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Comment provided by the student."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the review was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tutoringId",
        "studentId",
        "rating"
      ]
    },
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an event on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the event entity."
        },
        "organizerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Event)"
        },
        "title": {
          "type": "string",
          "description": "Title of the event."
        },
        "description": {
          "type": "string",
          "description": "Description of the event."
        },
        "category": {
          "type": "string",
          "description": "Category of the event (e.g., soirée, conférence, sport, culture)."
        },
        "startDate": {
          "type": "string",
          "description": "Start date and time of the event.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date and time of the event.",
          "format": "date-time"
        },
        "locationName": {
          "type": "string",
          "description": "Name of the event location."
        },
        "address": {
          "type": "string",
          "description": "Address of the event location."
        },
        "city": {
          "type": "string",
          "description": "City where the event is located."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the event location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the event location."
        },
        "price": {
          "type": "number",
          "description": "Price of the event."
        },
        "maxAttendees": {
          "type": "number",
          "description": "Maximum number of attendees for the event."
        },
        "currentAttendees": {
          "type": "number",
          "description": "Current number of attendees for the event."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the event image.",
          "format": "uri"
        },
        "university": {
          "type": "string",
          "description": "University associated with the event."
        },
        "tags": {
          "type": "array",
          "description": "Array of tags for the event (e.g., gratuit, étudiant, musique).",
          "items": {
            "type": "string"
          }
        },
        "isPublic": {
          "type": "boolean",
          "description": "Indicates if the event is public."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the event was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "organizerId",
        "title",
        "startDate"
      ]
    },
    "EventAttendee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EventAttendee",
      "type": "object",
      "description": "Represents a user attending an event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the event attendee entity."
        },
        "eventId": {
          "type": "string",
          "description": "Reference to Event. (Relationship: Event 1:N EventAttendee)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EventAttendee)"
        },
        "status": {
          "type": "string",
          "description": "Status of attendance (e.g., attending, maybe, not_attending)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the attendance was recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "eventId",
        "userId"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the message entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Message). ID of the user sending the message."
        },
        "receiverId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Message). ID of the user receiving the message."
        },
        "content": {
          "type": "string",
          "description": "Content of the message."
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates if the message has been read."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "receiverId",
        "content"
      ]
    },
    "Favorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Favorite",
      "type": "object",
      "description": "Represents a user's favorite item (housing, tutoring, event).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the favorite entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Favorite)"
        },
        "itemType": {
          "type": "string",
          "description": "Type of item favorited (e.g., housing, tutoring, event)."
        },
        "itemId": {
          "type": "string",
          "description": "ID of the item favorited."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the item was favorited.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "itemType",
        "itemId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Authorization is based on the 'userId' path parameter.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/housing/{housingId}",
        "definition": {
          "entityName": "Housing",
          "schema": {
            "$ref": "#/backend/entities/Housing"
          },
          "description": "Stores housing listings created by a user. Authorization is based on the 'userId' path parameter, ensuring only the user can manage their listings.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the housing listing."
            },
            {
              "name": "housingId",
              "description": "The unique identifier for the housing entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/carpooling/{carpoolingId}",
        "definition": {
          "entityName": "Carpooling",
          "schema": {
            "$ref": "#/backend/entities/Carpooling"
          },
          "description": "Stores carpooling offers created by a user.  Authorization is based on the 'userId' path parameter, ensuring only the user can manage their carpooling offers.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the carpooling offer."
            },
            {
              "name": "carpoolingId",
              "description": "The unique identifier for the carpooling entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tutoring/{tutoringId}",
        "definition": {
          "entityName": "Tutoring",
          "schema": {
            "$ref": "#/backend/entities/Tutoring"
          },
          "description": "Stores tutoring offers created by a user. Authorization is based on the 'userId' path parameter, ensuring only the user can manage their tutoring offers.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the tutoring offer."
            },
            {
              "name": "tutoringId",
              "description": "The unique identifier for the tutoring entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores events created by a user. Authorization is based on the 'userId' path parameter, ensuring only the user can manage their events.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the event."
            },
            {
              "name": "eventId",
              "description": "The unique identifier for the event entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/eventAttendees/{eventAttendeeId}",
        "definition": {
          "entityName": "EventAttendee",
          "schema": {
            "$ref": "#/backend/entities/EventAttendee"
          },
          "description": "Stores event attendance records for a user. Authorization is based on the 'userId' path parameter, ensuring only the user can manage their event attendance records.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who is attending the event."
            },
            {
              "name": "eventAttendeeId",
              "description": "The unique identifier for the event attendee entity."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages between users. Security rules will enforce that either senderId or receiverId must match request.auth.uid.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique identifier for the message entity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": {
            "$ref": "#/backend/entities/Favorite"
          },
          "description": "Stores a user's favorite items (housing, tutoring, event). Authorization is based on the 'userId' path parameter, ensuring only the user can manage their favorites.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the favorite."
            },
            {
              "name": "favoriteId",
              "description": "The unique identifier for the favorite entity."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). It leverages denormalization for authorization independence, structural segregation for homogeneous security postures, and consistent access modeling.\n\nAuthorization Independence is achieved by denormalizing authorization-related data directly into the documents where it's needed. For instance, the `Housing` documents are stored within the user's document (`/users/{userId}/housing/{housingId}`), making it easy to verify ownership and permissions without needing to perform expensive `get()` calls to parent documents.\n\nStructural Segregation is applied by storing user-owned data (housing, carpooling offers, tutoring offers, events, favorites) as subcollections of the user document (`/users/{userId}/housing`, `/users/{userId}/carpooling`, etc.). This ensures that all documents within a collection have the same security requirements, simplifying security rules and avoiding the need for complex logic to differentiate access.\n\nAccess Modeling follows consistent patterns: User-owned data uses hierarchical paths, collaborative data (if any) would use Membership Maps, and global roles (if any) would use dedicated collections. The current schema focuses on user-owned data, which is best represented through hierarchical paths.  Messages are stored in a top-level collection `/messages` because they represent communication between users, and security is enforced based on the `senderId` and `receiverId` fields.\n\nQAPs (Rules are not Filters) are supported through structural segregation. Listing operations can be secured by scoping queries to a user's subcollections or by using equality checks on denormalized fields."
  }
}