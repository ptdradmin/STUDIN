{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user within the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "phone": {
          "type": "string",
          "description": "User's phone number."
        },
        "university": {
          "type": "string",
          "description": "University the user attends."
        },
        "fieldOfStudy": {
          "type": "string",
          "description": "User's field of study."
        },
        "bio": {
          "type": "string",
          "description": "User's biography or description."
        },
        "profilePicture": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isVerified": {
          "type": "boolean",
          "description": "Indicates if the user's account is verified."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the user was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    },
    "Housing": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Housing",
      "type": "object",
      "description": "Represents a housing listing on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Housing entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Housing)"
        },
        "title": {
          "type": "string",
          "description": "Title of the housing listing."
        },
        "description": {
          "type": "string",
          "description": "Description of the housing."
        },
        "type": {
          "type": "string",
          "description": "Type of housing (e.g., kot, studio, colocation)."
        },
        "price": {
          "type": "number",
          "description": "Price of the housing."
        },
        "address": {
          "type": "string",
          "description": "Address of the housing."
        },
        "city": {
          "type": "string",
          "description": "City where the housing is located."
        },
        "postalCode": {
          "type": "string",
          "description": "Postal code of the housing."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the housing."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the housing."
        },
        "bedrooms": {
          "type": "number",
          "description": "Number of bedrooms in the housing."
        },
        "bathrooms": {
          "type": "number",
          "description": "Number of bathrooms in the housing."
        },
        "surfaceArea": {
          "type": "number",
          "description": "Surface area of the housing in square meters."
        },
        "availableFrom": {
          "type": "string",
          "description": "Date when the housing is available from.",
          "format": "date-time"
        },
        "photos": {
          "type": "array",
          "description": "Array of URLs to photos of the housing.",
          "items": {
            "type": "string"
          }
        },
        "amenities": {
          "type": "array",
          "description": "Array of amenities offered by the housing (e.g., wifi, parking, furnished).",
          "items": {
            "type": "string"
          }
        },
        "universityNearby": {
          "type": "string",
          "description": "Name of the university nearby."
        },
        "distanceToCampus": {
          "type": "number",
          "description": "Distance to campus in meters."
        },
        "isAvailable": {
          "type": "boolean",
          "description": "Indicates if the housing is currently available."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the housing listing was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the housing listing was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "type",
        "price",
        "address",
        "city"
      ]
    },
    "Carpooling": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Carpooling",
      "type": "object",
      "description": "Represents a carpooling opportunity on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Carpooling entity."
        },
        "driverId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Carpooling)"
        },
        "departureCity": {
          "type": "string",
          "description": "City of departure."
        },
        "departureAddress": {
          "type": "string",
          "description": "Departure address."
        },
        "arrivalCity": {
          "type": "string",
          "description": "City of arrival."
        },
        "arrivalAddress": {
          "type": "string",
          "description": "Arrival address."
        },
        "departureTime": {
          "type": "string",
          "description": "Departure time.",
          "format": "date-time"
        },
        "seatsAvailable": {
          "type": "number",
          "description": "Number of seats available."
        },
        "pricePerSeat": {
          "type": "number",
          "description": "Price per seat."
        },
        "description": {
          "type": "string",
          "description": "Description of the carpooling opportunity."
        },
        "carModel": {
          "type": "string",
          "description": "Car model being used for carpooling."
        },
        "preferences": {
          "type": "array",
          "description": "Array of preferences for the carpool (e.g., non-smoking, music).",
          "items": {
            "type": "string"
          }
        },
        "isRecurring": {
          "type": "boolean",
          "description": "Indicates if the carpooling is a recurring event."
        },
        "recurringDays": {
          "type": "array",
          "description": "Array of days when the carpooling recurs (e.g., Monday, Wednesday).",
          "items": {
            "type": "string"
          }
        },
        "status": {
          "type": "string",
          "description": "Status of the carpooling (e.g., active, full, completed, cancelled)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the carpooling opportunity was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "driverId",
        "departureCity",
        "arrivalCity",
        "departureTime",
        "seatsAvailable"
      ]
    },
    "CarpoolBooking": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CarpoolBooking",
      "type": "object",
      "description": "Represents a booking for a carpooling opportunity.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CarpoolBooking entity."
        },
        "carpoolId": {
          "type": "string",
          "description": "Reference to Carpooling. (Relationship: Carpooling 1:N CarpoolBooking)"
        },
        "passengerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CarpoolBooking)"
        },
        "seatsBooked": {
          "type": "number",
          "description": "Number of seats booked."
        },
        "status": {
          "type": "string",
          "description": "Status of the booking (e.g., pending, confirmed, cancelled)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the booking was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "carpoolId",
        "passengerId"
      ]
    },
    "Tutoring": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tutoring",
      "type": "object",
      "description": "Represents a tutoring offer on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tutoring entity."
        },
        "tutorId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Tutoring)"
        },
        "subject": {
          "type": "string",
          "description": "Subject being tutored."
        },
        "level": {
          "type": "string",
          "description": "Level of tutoring (e.g., bachelier, master, secondaire)."
        },
        "description": {
          "type": "string",
          "description": "Description of the tutoring offer."
        },
        "pricePerHour": {
          "type": "number",
          "description": "Price per hour for tutoring."
        },
        "locationType": {
          "type": "string",
          "description": "Type of location for tutoring (e.g., online, in-person, both)."
        },
        "availableLocations": {
          "type": "array",
          "description": "Array of available locations for tutoring (cities or campuses).",
          "items": {
            "type": "string"
          }
        },
        "availability": {
          "type": "string",
          "description": "Availability of the tutor (JSON format)."
        },
        "rating": {
          "type": "number",
          "description": "Average rating for the tutor."
        },
        "totalReviews": {
          "type": "number",
          "description": "Total number of reviews for the tutor."
        },
        "qualifications": {
          "type": "array",
          "description": "Array of qualifications of the tutor.",
          "items": {
            "type": "string"
          }
        },
        "isAvailable": {
          "type": "boolean",
          "description": "Indicates if the tutor is currently available."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the tutoring offer was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tutorId",
        "subject",
        "level"
      ]
    },
    "TutoringReview": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "TutoringReview",
      "type": "object",
      "description": "Represents a review for a tutoring offer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the TutoringReview entity."
        },
        "tutoringId": {
          "type": "string",
          "description": "Reference to Tutoring. (Relationship: Tutoring 1:N TutoringReview)"
        },
        "studentId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N TutoringReview)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the student (1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Comment provided by the student."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the review was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tutoringId",
        "studentId",
        "rating"
      ]
    },
    "Event": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Event",
      "type": "object",
      "description": "Represents an event listed on the STUD'IN platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Event entity."
        },
        "organizerId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Event)"
        },
        "title": {
          "type": "string",
          "description": "Title of the event."
        },
        "description": {
          "type": "string",
          "description": "Description of the event."
        },
        "category": {
          "type": "string",
          "description": "Category of the event (e.g., soirée, conférence, sport, culture)."
        },
        "startDate": {
          "type": "string",
          "description": "Start date and time of the event.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date and time of the event.",
          "format": "date-time"
        },
        "locationName": {
          "type": "string",
          "description": "Name of the location of the event."
        },
        "address": {
          "type": "string",
          "description": "Address of the event."
        },
        "city": {
          "type": "string",
          "description": "City where the event is located."
        },
        "latitude": {
          "type": "number",
          "description": "Latitude of the event location."
        },
        "longitude": {
          "type": "number",
          "description": "Longitude of the event location."
        },
        "price": {
          "type": "number",
          "description": "Price of the event."
        },
        "maxAttendees": {
          "type": "number",
          "description": "Maximum number of attendees allowed for the event."
        },
        "currentAttendees": {
          "type": "number",
          "description": "Current number of attendees for the event."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the event image.",
          "format": "uri"
        },
        "university": {
          "type": "string",
          "description": "University associated with the event."
        },
        "tags": {
          "type": "array",
          "description": "Array of tags associated with the event (e.g., gratuit, étudiant, musique).",
          "items": {
            "type": "string"
          }
        },
        "isPublic": {
          "type": "boolean",
          "description": "Indicates if the event is public."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the event was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "organizerId",
        "title",
        "startDate"
      ]
    },
    "EventAttendee": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "EventAttendee",
      "type": "object",
      "description": "Represents a user attending an event.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the EventAttendee entity."
        },
        "eventId": {
          "type": "string",
          "description": "Reference to Event. (Relationship: Event 1:N EventAttendee)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N EventAttendee)"
        },
        "status": {
          "type": "string",
          "description": "Status of attendance (e.g., attending, maybe, not_attending)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the attendance was recorded.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "eventId",
        "userId"
      ]
    },
    "Message": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Message",
      "type": "object",
      "description": "Represents a message exchanged between users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Message entity."
        },
        "senderId": {
          "type": "string",
          "description": "Reference to User (sender). (Relationship: User 1:N Message)"
        },
        "receiverId": {
          "type": "string",
          "description": "Reference to User (receiver). (Relationship: User 1:N Message)"
        },
        "content": {
          "type": "string",
          "description": "Content of the message."
        },
        "isRead": {
          "type": "boolean",
          "description": "Indicates if the message has been read."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the message was sent.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "senderId",
        "receiverId",
        "content"
      ]
    },
    "Favorite": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Favorite",
      "type": "object",
      "description": "Represents a user's favorite item (housing, tutoring, event).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Favorite entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Favorite)"
        },
        "itemType": {
          "type": "string",
          "description": "Type of item favorited (e.g., housing, tutoring, event)."
        },
        "itemId": {
          "type": "string",
          "description": "ID of the item favorited."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the item was favorited.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "itemType",
        "itemId"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Only the authenticated user can access their own profile.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/housing/{housingId}",
        "definition": {
          "entityName": "Housing",
          "schema": {
            "$ref": "#/backend/entities/Housing"
          },
          "description": "Stores housing listings created by a user. The authenticated user must match the userId to create, modify, or delete a listing.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the housing listing."
            },
            {
              "name": "housingId",
              "description": "The unique identifier of the housing listing."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/carpooling/{carpoolingId}",
        "definition": {
          "entityName": "Carpooling",
          "schema": {
            "$ref": "#/backend/entities/Carpooling"
          },
          "description": "Stores carpooling opportunities created by a user. Only the authenticated user who created the carpooling opportunity can modify or delete it.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the carpooling opportunity (driverId)."
            },
            {
              "name": "carpoolingId",
              "description": "The unique identifier of the carpooling opportunity."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/tutoring/{tutoringId}",
        "definition": {
          "entityName": "Tutoring",
          "schema": {
            "$ref": "#/backend/entities/Tutoring"
          },
          "description": "Stores tutoring offers created by a user. Only the authenticated user who created the tutoring offer can modify or delete it.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the tutoring offer (tutorId)."
            },
            {
              "name": "tutoringId",
              "description": "The unique identifier of the tutoring offer."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/events/{eventId}",
        "definition": {
          "entityName": "Event",
          "schema": {
            "$ref": "#/backend/entities/Event"
          },
          "description": "Stores events created by a user. Only the authenticated user who created the event can modify or delete it.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the event (organizerId)."
            },
            {
              "name": "eventId",
              "description": "The unique identifier of the event."
            }
          ]
        }
      },
      {
        "path": "/messages/{messageId}",
        "definition": {
          "entityName": "Message",
          "schema": {
            "$ref": "#/backend/entities/Message"
          },
          "description": "Stores messages exchanged between users. Access control is based on senderId and receiverId.",
          "params": [
            {
              "name": "messageId",
              "description": "The unique identifier of the message."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{favoriteId}",
        "definition": {
          "entityName": "Favorite",
          "schema": {
            "$ref": "#/backend/entities/Favorite"
          },
          "description": "Stores a user's favorite items. Only the authenticated user can access their own favorites.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user who created the favorite."
            },
            {
              "name": "favoriteId",
              "description": "The unique identifier of the favorite."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to follow the principle of path-based ownership and denormalization for authorization independence. This approach ensures that security rules can be written without relying on `get()` calls, enabling atomic operations and improving debuggability. The structure also adheres to the principle of segregating data based on security posture.\n\n*   **Users Collection:** The `users` collection stores user profiles. Access to a user's document is restricted to the user themselves, ensuring privacy of personal data. This implements Path-Based Ownership.\n*   **Housing Collection:** Housing data is stored in `/users/{userId}/housing/{housingId}`. This structure enables simple, ownership-based security rules, as only the user who created the housing can modify or delete it. This structure is highly secure and efficient.\n*   **Carpooling Collection:** Carpooling data is stored in `/users/{userId}/carpooling/{carpoolingId}`. Only the owner of the carpooling can modify it.\n*   **Tutoring Collection:** Tutoring data is stored in `/users/{userId}/tutoring/{tutoringId}`. Only the owner can modify.\n*   **Events Collection:** Events are stored in `/users/{userId}/events/{eventId}`. Only the owner can modify. \n*   **Messages:** Messages are stored in a top-level `messages` collection. Each message contains `senderId` and `receiverId`, used to authorize read access. The message content itself is secured via rules to restrict modification after creation.\n*   **Favorites:** Favorites are stored in `/users/{userId}/favorites/{favoriteId}`. Only the owner can modify.\n\n**Authorization Independence (Denormalization):**\n\n*   The subcollections, like `housing`, `carpooling`, `tutoring`, and `events`, DO NOT require denormalization of parent (user) data because their paths already enforce user-based ownership. The security rules can simply check if `request.auth.uid == userId`.\n*   For collaborative data (if any were present), membership maps in documents would be crucial to achieving authorization independence.\n\n**QAPs Support:**\n\n*   **Secure List Operations:** Because data is segregated based on ownership and the path includes the userId, `list` operations are inherently secure. Rules can easily enforce that a user can only list documents within their own `users/{userId}` path.\n\nThis design supports secure and scalable data access, aligning with Firebase best practices."
  }
}